<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¹Ø¬Ù„Ø© ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #00d2ff; --success: #00c851; --danger: #ff4444; }
        body { margin: 0; font-family: 'Cairo', sans-serif; background: #0f172a; color: white; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        #startScreen { position: fixed; inset: 0; z-index: 2000; background: #0f172a; display: flex; justify-content: center; align-items: center; }
        .login-card { background: rgba(255, 255, 255, 0.05); padding: 40px; border-radius: 24px; text-align: center; border: 1px solid var(--primary); width: 380px; }

        .main-layout { display: none; flex: 1; padding: 20px; gap: 20px; justify-content: center; align-items: center; }
        .leaderboard { width: 250px; background: rgba(255, 255, 255, 0.05); border-radius: 20px; padding: 15px; height: 80vh; overflow-y: auto; border: 1px solid rgba(255,255,255,0.1); }
        .score-item { display: flex; justify-content: space-between; padding: 8px; background: rgba(255,255,255,0.05); margin-bottom: 5px; border-radius: 5px; border-right: 4px solid var(--primary); }

        .game-container { text-align: center; }
        .stats-bar { display: flex; gap: 20px; background: rgba(255,255,255,0.1); padding: 10px 30px; border-radius: 50px; margin-bottom: 20px; align-items: center; justify-content: center; }
        
        .wheel-box { position: relative; width: 350px; height: 350px; margin: auto; }
        #canvas { width: 100%; height: 100%; border-radius: 50%; border: 5px solid white; transition: transform 4s cubic-bezier(0.1, 0, 0.1, 1); }
        .pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); z-index: 100; width: 40px; }

        input, button.main-btn, .danger-btn { width: 100%; padding: 12px; border-radius: 10px; border: none; margin: 10px 0; font-family: 'Cairo'; font-size: 1.1rem; box-sizing: border-box; }
        button.main-btn { background: var(--primary); cursor: pointer; font-weight: bold; color: #0f172a; }
        
        /* Ø²Ø± Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø³Ø±ÙŠ - Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
        #adminClearBtn { display: none; background: var(--danger); cursor: pointer; color: white; font-weight: bold; margin-top: 20px; border: 2px dashed white; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 3000; }
        .modal { background: #1e293b; width: 400px; padding: 30px; border-radius: 20px; text-align: center; border: 2px solid var(--primary); }
        
        .timer-container { height: 15px; background: #334155; border-radius: 10px; margin: 15px 0; overflow: hidden; }
        #timerFill { height: 100%; background: linear-gradient(to left, var(--success), var(--primary)); width: 100%; transition: width 0.1s linear; }
        
        .opt-btn { background: rgba(255,255,255,0.1); color: white; padding: 12px; border-radius: 10px; width: 100%; margin: 8px 0; cursor: pointer; border: 1px solid rgba(255,255,255,0.2); font-family: 'Cairo'; font-size: 1rem; }
        .correct { background: var(--success) !important; color: white; }
        .wrong { background: var(--danger) !important; color: white; }
        
        #gameTitle { cursor: pointer; user-select: none; }
    </style>
</head>
<body>

    <audio id="bgMusic" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"></audio>
    <audio id="spinSound" src="https://assets.mixkit.co/active_storage/sfx/2005/2005-preview.mp3"></audio>
    <audio id="correctSound" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>
    <audio id="wrongSound" src="https://assets.mixkit.co/active_storage/sfx/2955/2955-preview.mp3"></audio>

    <div id="startScreen">
        <div class="login-card">
            <h1 id="gameTitle" title="Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø¹Ù„Ù…">ğŸ¡ Ø¹Ø¬Ù„Ø© ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h1>
            <p>Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠ</p>
            <input type="text" id="pName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨">
            <input type="text" id="pClass" placeholder="Ø§Ù„ØµÙ Ù…Ø«Ù„Ø§ : 5\1">
            <button class="main-btn" onclick="startGame()">Ø¯Ø®ÙˆÙ„</button>
            
            <button id="adminClearBtn" class="danger-btn" onclick="clearAllData()">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø¹Ù„Ù…) ğŸ—‘ï¸</button>
        </div>
    </div>

    <div class="main-layout" id="mainLayout">
        <div class="leaderboard">
            <h3 style="text-align:center">ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙˆÙ†</h3>
            <div id="scoresList"></div>
        </div>

        <div class="game-container">
            <div class="stats-bar">
                <span>ğŸ‘¤ <span id="statName">--</span></span>
                <span>ğŸ… Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="statScore">0</span></span>
                <button onclick="logout()" style="background:var(--danger); border:none; color:white; padding:5px 10px; border-radius:10px; cursor:pointer;">Ø®Ø±ÙˆØ¬ ğŸšª</button>
            </div>
            <div class="wheel-box">
                <img src="https://cdn-icons-png.flaticon.com/512/2722/2722987.png" class="pointer">
                <canvas id="canvas" width="500" height="500"></canvas>
            </div>
            <button class="main-btn" id="spinBtn" style="width:200px; margin-top:20px;" onclick="spinWheel()">ğŸ¡ Ø¯ÙÙˆÙ‘Ø± Ø§Ù„Ø¹Ø¬Ù„Ø©</button>
        </div>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span>â± Ø§Ù„ÙˆÙ‚Øª: <b id="secondsText">10</b></span>
                <span style="color:var(--success)">âš¡ Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø³Ø±Ø¹Ø©</span>
            </div>
            <div class="timer-container"><div id="timerFill"></div></div>
            <h2 id="qText">Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ</h2>
            <div id="optionsGrid"></div>
        </div>
    </div>

<script>
    // --- Ù…ÙŠØ²Ø© Ø§Ù„Ù…Ø¹Ù„Ù… Ø§Ù„Ø³Ø±ÙŠØ© ---
    let pressTimer;
    const gameTitle = document.getElementById('gameTitle');
    const adminBtn = document.getElementById('adminClearBtn');

    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø·ÙˆÙ„ (3 Ø«ÙˆØ§Ù†ÙŠ) Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    gameTitle.addEventListener('mousedown', startPress);
    gameTitle.addEventListener('touchstart', startPress);
    gameTitle.addEventListener('mouseup', cancelPress);
    gameTitle.addEventListener('touchend', cancelPress);

    function startPress() {
        pressTimer = window.setTimeout(function() {
            adminBtn.style.display = 'block';
            alert("Ù†Ù…Ø· Ø§Ù„Ù…Ø¹Ù„Ù… Ù…ÙØ¹Ù„: ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        }, 3000); 
    }

    function cancelPress() {
        clearTimeout(pressTimer);
    }
    // -------------------------

    const questions = [
        {q: "Ù…Ø§ Ù‡Ùˆ Ø§Ø®ØªØµØ§Ø± ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©ØŸ", o: ["RAM", "CPU", "USB"], a: 1},
        {q: "ØªØ¹ØªØ¨Ø± Ø§Ù„Ø´Ø§Ø´Ø© Ù…Ù† ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ù€ ...ØŸ", o: ["Ø¥Ø®Ø±Ø§Ø¬", "Ø¥Ø¯Ø®Ø§Ù„", "Ù…Ø¹Ø§Ù„Ø¬Ø©"], a: 0},
        {q: "Ø£ÙŠ Ù…Ù…Ø§ ÙŠÙ„ÙŠ ÙŠØ¹ØªØ¨Ø± Ù†Ø¸Ø§Ù… ØªØ´ØºÙŠÙ„ØŸ", o: ["Word", "Windows", "Youtube"], a: 1},
        {q: "Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ù†Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø®ØªØµØ§Ø±ØŸ", o: ["Ctrl+S", "Ctrl+P", "Ctrl+C"], a: 0},
        {q: "Ø§Ù„ÙØ£Ø±Ø© ØªØ¹ØªØ¨Ø± Ù…Ù† ÙˆØ­Ø¯Ø§ØªØŸ", o: ["Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬", "Ø¥Ø¯Ø®Ø§Ù„", "Ø§Ù„ØªØ®Ø²ÙŠÙ†"], a: 1}
    ];

    let score = 0;
    let currentRotation = 0;
    let isSpinning = false;
    let timerInterval;
    let timeLeft = 10;

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const colors = ['#FF5E5E', '#FFB84E', '#4E9FFF', '#4EFC9F', '#B34EFC', '#FC4EED', '#FCEE4E', '#4EFCF0'];

    function drawWheel() {
        const segments = 8;
        const angle = 2 * Math.PI / segments;
        for(let i=0; i<segments; i++) {
            ctx.beginPath();
            ctx.fillStyle = colors[i];
            ctx.moveTo(250, 250);
            ctx.arc(250, 250, 250, i * angle, (i + 1) * angle);
            ctx.fill();
            ctx.save();
            ctx.translate(250, 250);
            ctx.rotate(i * angle + angle/2);
            ctx.fillStyle = "white";
            ctx.font = "bold 35px Cairo";
            ctx.fillText(i + 1, 150, 10);
            ctx.restore();
        }
    }

    function startGame() {
        const n = document.getElementById('pName').value;
        const c = document.getElementById('pClass').value;
        if(!n || !c) return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙØµÙ„");
        
        const bgMusic = document.getElementById('bgMusic');
        bgMusic.volume = 0.3; 
        bgMusic.play().catch(() => {});
        
        document.getElementById('statName').innerText = n + " (" + c + ")";
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('mainLayout').style.display = 'flex';
        
        drawWheel();
        updateLeaderboard();
    }

    function clearAllData() {
        if(confirm("Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„ØµÙ Ø¢Ø®Ø±ØŒ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) {
            localStorage.removeItem('ranking');
            updateLeaderboard();
            adminBtn.style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
            alert("ØªÙ… Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¨Ù†Ø¬Ø§Ø­!");
        }
    }

    function logout() {
        location.reload();
    }

    function spinWheel() {
        if(isSpinning) return;
        isSpinning = true;
        document.getElementById('spinSound').play();
        const extraDeg = Math.floor(Math.random() * 360) + 2160;
        currentRotation += extraDeg;
        canvas.style.transform = `rotate(${currentRotation}deg)`;
        
        setTimeout(() => { 
            isSpinning = false; 
            showQuestion(); 
        }, 4000);
    }

    function showQuestion() {
        const q = questions[Math.floor(Math.random() * questions.length)];
        document.getElementById('qText').innerText = q.q;
        const grid = document.getElementById('optionsGrid');
        grid.innerHTML = '';
        
        timeLeft = 10;
        document.getElementById('secondsText').innerText = "10";
        document.getElementById('timerFill').style.transition = 'none';
        document.getElementById('timerFill').style.width = "100%";
        
        setTimeout(() => {
            document.getElementById('timerFill').style.transition = 'width 0.1s linear';
            document.getElementById('modalOverlay').style.display = 'flex';
        }, 50);

        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft -= 0.1;
            document.getElementById('timerFill').style.width = (timeLeft * 10) + "%";
            document.getElementById('secondsText').innerText = Math.ceil(timeLeft);

            if(timeLeft <= 0) {
                clearInterval(timerInterval);
                document.getElementById('wrongSound').play();
                alert("Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!");
                document.getElementById('modalOverlay').style.display = 'none';
            }
        }, 100);

        q.o.forEach((opt, i) => {
            const b = document.createElement('button');
            b.className = 'opt-btn';
            b.innerText = opt;
            b.onclick = () => {
                clearInterval(timerInterval);
                if(i === q.a) {
                    b.classList.add('correct');
                    document.getElementById('correctSound').play();
                    score += Math.floor(timeLeft * 10) + 20;
                    document.getElementById('statScore').innerText = score;
                    confetti();
                } else {
                    b.classList.add('wrong');
                    document.getElementById('wrongSound').play();
                }
                saveScore();
                setTimeout(() => { document.getElementById('modalOverlay').style.display = 'none'; }, 1200);
            };
            grid.appendChild(b);
        });
    }

    function saveScore() {
        let players = JSON.parse(localStorage.getItem('ranking') || '[]');
        const name = document.getElementById('statName').innerText;
        const idx = players.findIndex(p => p.name === name);
        if(idx > -1) players[idx].score = Math.max(players[idx].score, score);
        else players.push({name, score});
        localStorage.setItem('ranking', JSON.stringify(players));
        updateLeaderboard();
    }

    function updateLeaderboard() {
        const players = JSON.parse(localStorage.getItem('ranking') || '[]');
        players.sort((a,b) => b.score - a.score);
        document.getElementById('scoresList').innerHTML = players.slice(0, 10).map(p => 
            `<div class="score-item"><span>${p.name}</span><b>${p.score}</b></div>`
        ).join('');
    }
</script>
</body>
</html>

